<section class="container mt-4">
  <h1 class="mb-3">Best Borough of the Week</h1>
  <p class="text-muted">Week starting {{weekStart}}</p>

  {{!-- server-driven toast for this page --}}
  {{#if toast}}
    <div id="server-flash-global"
         {{#if (eq toast.type "error")}}
           data-error="{{toast.message}}"
         {{else}}
           data-message="{{toast.message}}"
         {{/if}}>
    </div>
  {{/if}}

  {{!-- Winner summary --}}
  {{#if bestBorough}}
    <div class="card mb-4">
      <div class="card-body">
        <h3 class="card-title">{{bestBorough.name}}</h3>
        <p class="card-text">{{bestBorough.description}}</p>
        <p><strong>Total votes this week:</strong> {{bestBorough.voteCount}}</p>
      </div>
    </div>
  {{else}}
    <p>No votes have been cast this week yet. Be the first to vote below!</p>
  {{/if}}

<hr class="my-4">

<h2 class="h4 mb-3">Cast Your Vote</h2>

{{#if isAuthenticated}}

  {{#if userHasVoted}}
    <p class="text-muted mb-3">
      You have already voted this week. Here is the borough you chose:
    </p>
  {{else}}
    <p class="text-muted mb-3">
      Select the borough you think deserves to be Best Borough this week. You can vote once per week.
    </p>
  {{/if}}

  <div class="row">
    {{#each boroughs}}
      <div class="col-md-4 mb-3">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">{{this.name}}</h5>
            {{!-- <p class="card-text">
              {{this.description}}
            </p> --}}

            {{#if ../userHasVoted}}
              {{!-- User already voted → only their chosen borough is in the list --}}
              <button class="btn btn-success mt-2" disabled>✓ Voted this week</button>
            {{else}}
              {{!-- User has not voted yet → show vote button --}}
              <form method="POST" action="/votes">
                <input type="hidden" name="boroughId" value="{{this._id}}">
                <button class="btn btn-outline-primary mt-2">
                  Vote for {{this.name}}
                </button>
              </form>
            {{/if}}

          </div>
        </div>
      </div>
    {{/each}}
  </div>

{{else}}
  <p class="text-muted mb-3">
    You need to be signed in to vote for the Best Borough.
  </p>
  <a href="/users/login?redirect=/votes/best" class="btn btn-primary">Sign in to vote</a>

{{/if}}


</section>
